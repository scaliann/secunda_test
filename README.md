# 1. Запуск проекта

Для запуска проекта необходим Docker и Docker Compose.

**Клонируйте репозиторий:**

- git clone git@github.com:scaliann/secunda_test.git
- cd secunda_test

**Настройте переменные окружения:** Скопируйте пример файла конфигурации:
- Создайте файл .env
- Переместите туда все данные из .env.example

**Соберите и запустите контейнеры.** Команда соберёт образы и запустит приложение с базой данных:
- docker-compose up --build


После успешного запуска API будет доступно по адресу: `http://localhost:8000`.

**Проверка работоспособности:**
*   Health Check: `http://localhost:8000/health`
*   Документация Swagger UI: `http://localhost:8000/docs`
*   Альтернативная документация ReDoc: `http://localhost:8000/redoc`

# 2. Описание проекта и API

В этом проекте реализована гибкая система поиска организаций. Вместо создания множества отдельных конечных ручек для каждого сценария, используется **один универсальный эндпоинт GET `/api/v1/organizations`**, который принимает различные параметры фильтрации. Это позволяет комбинировать условия поиска и выполнять сложные запросы в одном вызове.

## Параметры фильтрации

Все параметры являются **опциональными**. Если параметры не указаны, возвращаются все организации. Фильтры комбинируются по логическому оператору **И**.

*   **`organization_ids` (string)**  
    Фильтр по ID организаций. Несколько значений указываются через запятую (напр., `1,2,3`).

*   **`building_ids` (string)**  
    Фильтр по ID зданий. Несколько значений указываются через запятую. Позволяет найти все организации в конкретных зданиях.

*   **`activity_ids` (string)**  
    Фильтр по ID видов деятельности. Несколько значений указываются через запятую. Найдёт организации, связанные с указанными видами деятельности.

*   **`search_str` (string)**  
    Поиск по названию организации. Регистронезависимый частичный поиск (напр., `рога` найдёт "ООО Рога и Копыта").

*   **`activity_search_str` (string)**  
    **Поиск по иерархии видов деятельности.** Указывается название. В результатах будут организации, связанные как с самой указанной деятельностью, так и со всеми её дочерними элементами в дереве (вплоть до 3 уровня). Например, поиск по `Еда` найдёт организации с деятельностью "Еда", "Молочная продукция", "Сыры" и т.д.

*   **`latitude`, `longitude`, `radius` (float)**  
    **Геопоиск по радиусу.** Необходимо указывать все три параметра вместе. Ищутся здания в пределах указанного радиуса (в километрах) от заданной точки координат. В ответ попадают все организации, расположенные в этих зданиях.

# 3. Примеры запросов для тестирования

Для выполнения запросов необходим API-ключ, который нужно указать в заголовке `Authorization`. 
Поэтому необходимо в Postman добавить заголовок Authorization:test_api_key

## Пример 1: Поиск по названию организации

http://localhost:8000/api/v1/organizations?search_str=Рога

**Что проверить:** Возвратится организация "ООО Рога и Копыта". Демонстрирует простой текстовый поиск.

## Пример 2: Поиск по иерархии видов деятельности

http://localhost:8000/api/v1/organizations?activity_search_str=Еда

**Что проверить:** В ответе будут организации, чья деятельность связана с "Еда" или любым её подвидом ("Молочная продукция", "Сыры" и т.д.). Показывает мощь фильтрации по дереву.

## Пример 3: Геопоиск организаций в радиусе

http://localhost:8000/api/v1/organizations?latitude=55.7600&longitude=37.6175&radius=5

**Что проверить:** Вернутся организации, чьи здания находятся в пределах 5 км от координат в центре Москвы. Демонстрирует работу геопоиска.

## Пример 4: Комбинированная фильтрация

http://localhost:8000/api/v1/organizations?building_ids=1&activity_ids=2,3

**Что проверить:** Результатом будут организации, которые **одновременно** находятся в здании с `id=1` И занимаются деятельностью с `id=2` **или** `id=3`. Пример использования нескольких фильтров для точного поиска.

## Пример 5: Получение детальной информации

http://localhost:8000/api/v1/organizations/1

**Что проверить:** В ответ придет полный JSON-объект организации с `id=1`, включая её название, телефоны, информацию о здании и список видов деятельности.

---
Для интерактивного тестирования и просмотра всех параметров используйте встроенную документацию Swagger UI: `http://localhost:8000/docs`.